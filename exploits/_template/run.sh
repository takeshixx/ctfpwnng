#!/bin/bash
set -e
script=${0##*/}
source ../../lib.sh
source ./service

if [ $# -lt 1 ];then
    echo "Usage: ${script} <target host>" >&2
    echo "Example: ${script} 10.20.1.100" >&2
    exit 2
fi

_SERVICE_HOST=$1

if [ $# -eq 2 ];then
    _SERVICE_PORT=$2
fi

if [ $# -eq 3 ];then
    _SERVICE_URL=$3
fi

if ! cat ../../targets/_current | grep "$_SERVICE_HOST" | grep -qi "${_SERVICE_PORT}/open";then
    debug "Service port ${_SERVICE_PORT} on host ${_SERVICE_HOST} not available, skipping."
    exit
fi

# Do exploit stuff. The output of the
# actual exploit should be stored in
# the _EXPLOIT_OUTPUT variable for
# further processing.
_EXPLOIT_OUTPUT=


# EXPLOIT STUFF HERE

_EXPLOIT_OUTPUT="$(./exploit.py "${_SERVICE_HOST}" "${_SERVICE_PORT}")"


log_flags "$_SERVICE_NAME" "$_EXPLOIT_OUTPUT"
